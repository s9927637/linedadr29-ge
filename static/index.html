<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>疫苗接種提醒表單</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
     <style>
         background-image: url(data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e);
         background-position: right 0.5rem center;
         background-repeat: no-repeat;
         background-size: 1.5em 1.5em;
         padding-right: 2.5rem;
         -webkit-print-color-adjust: exact;
     </style>
</head>
<body>
    <div class="bg-gray-100 flex items-center justify-center min-h-screen">
        <div class="bg-white shadow-md rounded-lg p-8 w-full max-w-md sm:max-w-lg md:max-w-xl">
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800 pt-2">疫苗接種提醒通知</h2>
            <form id="vaccine-form" class="space-y-6">
                <!-- 姓名 -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-900">姓名</label>
                    <input type="text" id="name" name="name" required
                        class="mt-2.5 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
                </div>

                <!-- 電話 -->
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-900">電話</label>
                    <input type="text" id="phone" name="phone" required
                        class="mt-2.5 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
                    <p id="phone-error" class="mt-1 text-red-500 text-sm hidden">請輸入有效的 10 位數電話號碼。</p>
                </div>

                <!-- 疫苗名稱 -->
                <div>
                    <label for="vaccine" class="block text-sm font-medium text-gray-900">疫苗名稱</label>
                    <select id="vaccine" name="vaccine" required
                        class="text-sm mt-2.5 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 bg-white">
                        <option value="" disabled selected>請選擇疫苗名稱</option>
                        <option value="子宮頸疫苗">子宮頸疫苗</option>
                        <option value="欣克疹疫苗">欣克疹疫苗</option>
                        <option value="A肝疫苗">A肝疫苗</option>
                    </select>
                </div>

                <!-- 接種日期 -->
                <div>
                    <label for="date" class="block text-sm font-medium text-gray-900">接種日期</label>
                    <input type="date" id="date" name="date" required
                        class="text-sm mt-2.5 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 bg-white">
                </div>

                <!-- 隱藏字段 -->
                <input type="hidden" id="userID" name="userID">

                <!-- 提交按鈕 -->
                <div class="flex justify-center pt-8">
                    <button type="submit"
                        class="w-full md:w-auto bg-indigo-600 text-white font-medium py-2 px-6 rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        提交預約
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        document.getElementById('vaccine-form').addEventListener('submit', function (e) {
            const phoneInput = document.getElementById('phone');
            const phoneError = document.getElementById('phone-error');
            const phoneValue = phoneInput.value.trim();

            // 驗證電話是否為 10 位數字
            if (!/^\d{10}$/.test(phoneValue)) {
                e.preventDefault(); // 阻止表單提交
                phoneError.classList.remove('hidden'); // 顯示錯誤訊息
                phoneInput.classList.add('border-red-500'); // 顯示錯誤邊框
                phoneInput.focus(); // 聚焦到電話欄位
            } else {
                phoneError.classList.add('hidden'); // 隱藏錯誤訊息
                phoneInput.classList.remove('border-red-500'); // 移除錯誤邊框
            }
        });
    </script>
        <script>
        // 初始化LIFF應用，獲取userID並填入隱藏欄位
        window.onload = function() {
            liff.init({ liffId: "2003645883-Rn6V0a3n" }).then(() => {
                if (liff.isLoggedIn()) {
                    liff.getProfile().then(profile => {
                        // 將userID填入表單的隱藏欄位
                        document.getElementById('userID').value = profile.userId;
                    }).catch((error) => {
                        console.error('取得用戶資料錯誤:', error);
                    });
                } else {
                    liff.login();  // 如果用戶尚未登入，則引導其登入
                }
            }).catch((error) => {
                console.error('LIFF初始化錯誤:', error);
            });
        };

        // 提交表單並將資料傳送至後端
        document.getElementById('vaccine-form').addEventListener('submit', function(event) {
            event.preventDefault(); // 防止表單重新整理頁面

            const userName = document.getElementById('name').value;
            const userPhone = document.getElementById('phone').value;
            const vaccineName = document.getElementById('vaccine').value;
            const appointmentDate = document.getElementById('date').value;
            const userID = document.getElementById('userID').value;

            const formTime = new Date().toISOString(); // 記錄填表時間

            // 發送資料至後端
            fetch('https://linedadr29ga.hkg1.zeabur.app/saveData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userID, userName, userPhone, vaccineName, appointmentDate, formTime }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('預約成功！');
                    // 可以選擇重定向或清除表單
                    // window.location.href = "some_url";
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('預約失敗，請稍後再試');
            });
        });
    </script>
</body>
</html>
